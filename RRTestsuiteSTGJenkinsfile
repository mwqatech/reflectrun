pipeline {
  agent any
  stages {
    stage('QA Staging Sanity'){
     parallel{
        stage('Man Matters Staging Sanity') {
          steps {
            sh 'ls -l'
          }
        }
        stage('BE Bodywise Staging Sanity') {
          steps {
            sh 'ls -l'
          }
        }
        stage('Little Joys Staging Sanity') {
          steps {
            sh 'python3 reflect_run_lj_stg_ts.py'
          }
        }
    }
  }
  }   
  post {
        always {
          emailext body: "${currentBuild.currentResult}: Job ${env.JOB_NAME} build ${env.BUILD_NUMBER}\n More info at: ${env.BUILD_URL}",
                attachLog: true, recipientProviders: [[$class: 'DevelopersRecipientProvider'], [$class: 'RequesterRecipientProvider']],
                to: 'bhushan.pujar@mosaicwellness.in, arun.ramesh@mosaicwellness.in, abhay.kaintura@mosaicwellness.in, tejaswini.gowda@mosaicwellness.in, basanagouda.b@mosaicwellness.in', 
                subject: "Jenkins Build ${currentBuild.currentResult}: Job ${env.JOB_NAME}"
                
          create_newjira_issue()      
            }
        //failure {
          //create_newjira_issue()
        //}
    }  
}
void create_newjira_issue() {
    node {
      stage('Defect Management') {
        def NewJiraIssue = [fields: [project: [key: 'MWQA'],
            summary: QA Sanity Test Build ${currentBuild.number} Status -> ${currentBuild.currentResult},
            description: 'Sanity TCs Failed for Man Matters/Be Bodywise/Little Joys -> Please check on ${build_url} and ${build_num} for the job ${job_name}',
            issuetype: [id: '10108']]]

    response = jiraNewIssue issue: NewJiraIssue, site: 'JIRA'

    echo response.successful.toString()
    echo response.data.toString()
    }
  }
}
